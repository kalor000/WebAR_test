<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìŠ¤ê´€ ë°°ê´€ AR ìœ„ì¹˜ í‘œì‹œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ar.js/2.2.2/aframe-ar.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        .controls {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            font-size: 14px;
            max-width: 300px;
        }
        
        .pipe-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            font-size: 12px;
            max-width: 200px;
            border: 2px solid #ff6b35;
        }
        
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 0;
            width: 100%;
        }
        
        button:hover {
            background: #e55a2b;
        }
        
        .status {
            background: rgba(0,255,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin-top: 5px;
        }
        
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <h2>AR ì´ˆê¸°í™” ì¤‘...</h2>
        <p>ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”</p>
    </div>

    <div class="controls">
        <h3>ğŸ”§ ê°€ìŠ¤ê´€ AR ì œì–´</h3>
        <button onclick="togglePipes()">ë°°ê´€ í‘œì‹œ/ìˆ¨ê¹€</button>
        <button onclick="addRandomPipe()">ëœë¤ ë°°ê´€ ì¶”ê°€</button>
        <button onclick="clearAllPipes()">ëª¨ë“  ë°°ê´€ ì‚­ì œ</button>
        <div class="status">
            ë°°ê´€ ê°œìˆ˜: <span id="pipeCount">3</span>ê°œ
        </div>
        <div style="font-size: 11px; margin-top: 10px; color: #ccc;">
            í™”ë©´ì„ ëŒë ¤ì„œ ì£¼ë³€ ë°°ê´€ì„ í™•ì¸í•˜ì„¸ìš”
        </div>
    </div>

    <div class="pipe-info">
        <h4>ğŸš° ë°°ê´€ ì •ë³´</h4>
        <div><strong>ID:</strong> GP-001</div>
        <div><strong>ì§ê²½:</strong> 300mm</div>
        <div><strong>ì¬ì§ˆ:</strong> ê°•ê´€</div>
        <div><strong>ì••ë ¥:</strong> ì¤‘ì••</div>
        <div><strong>ê¹Šì´:</strong> 1.5m</div>
        <div style="color: red; font-weight: bold; margin-top: 5px;">
            âš ï¸ êµ´ì°© ì£¼ì˜
        </div>
    </div>

    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        gesture-detector
        id="scene">
        
        <a-assets>
            <a-mixin id="pipe-material" 
                     material="color: #ff6b35; metalness: 0.8; roughness: 0.2;">
            </a-mixin>
            <a-mixin id="danger-material" 
                     material="color: red; emissive: red; emissiveIntensity: 0.3;">
            </a-mixin>
        </a-assets>

        <!-- ê¸°ë³¸ ë°°ê´€ë“¤ -->
        <a-entity id="pipe-container">
            <!-- ë©”ì¸ ê°€ìŠ¤ê´€ -->
            <a-cylinder 
                position="0 -1 -3"
                rotation="0 0 90"
                radius="0.15"
                height="4"
                mixin="pipe-material"
                class="gas-pipe"
                animation="property: rotation; to: 0 360 90; loop: true; dur: 20000">
            </a-cylinder>
            
            <!-- ë¶„ê¸°ê´€ 1 -->
            <a-cylinder 
                position="2 -1 -3"
                rotation="0 0 90"
                radius="0.1"
                height="2.5"
                mixin="pipe-material"
                class="gas-pipe">
            </a-cylinder>
            
            <!-- ë¶„ê¸°ê´€ 2 -->
            <a-cylinder 
                position="-2 -1 -3"
                rotation="0 0 90"
                radius="0.1"
                height="2.5"
                mixin="pipe-material"
                class="gas-pipe">
            </a-cylinder>

            <!-- ì—°ê²° ë°°ê´€ë“¤ -->
            <a-box 
                position="0 -1 -3"
                width="4"
                height="0.3"
                depth="0.3"
                mixin="pipe-material"
                class="gas-pipe">
            </a-box>
            
            <!-- ìœ„í—˜ í‘œì‹œ -->
            <a-box 
                position="0 0.5 -3"
                width="1"
                height="1"
                depth="0.1"
                mixin="danger-material"
                class="gas-pipe">
                <a-text 
                    value="âš ï¸ GAS\nìœ„í—˜"
                    position="0 0 0.06"
                    align="center"
                    color="white"
                    scale="2 2 2">
                </a-text>
            </a-box>
        </a-entity>

        <!-- ì •ë³´ ë¼ë²¨ë“¤ -->
        <a-text 
            value="ë©”ì¸ ê°€ìŠ¤ê´€\nGP-001\nì§ê²½: 300mm\nê¹Šì´: 1.5m"
            position="0 1 -3"
            align="center"
            color="white"
            background="color: rgba(0,0,0,0.7); opacity: 0.8"
            scale="0.8 0.8 0.8"
            class="info-label">
        </a-text>

        <a-text 
            value="ë¶„ê¸°ê´€ A\nGP-002\nì§ê²½: 200mm"
            position="2 1 -3"
            align="center"
            color="white"
            background="color: rgba(0,0,0,0.7); opacity: 0.8"
            scale="0.6 0.6 0.6"
            class="info-label">
        </a-text>

        <a-text 
            value="ë¶„ê¸°ê´€ B\nGP-003\nì§ê²½: 200mm"
            position="-2 1 -3"
            align="center"
            color="white"
            background="color: rgba(0,0,0,0.7); opacity: 0.8"
            scale="0.6 0.6 0.6"
            class="info-label">
        </a-text>

        <!-- ì¡°ëª… -->
        <a-light type="ambient" color="white" intensity="0.5"></a-light>
        <a-light type="directional" position="0 10 0" intensity="0.3"></a-light>

        <!-- ì¹´ë©”ë¼ -->
        <a-camera-static></a-camera-static>
    </a-scene>

    <script>
        let pipeCount = 3;
        let pipesVisible = true;
        
        // AR ì´ˆê¸°í™” ì™„ë£Œ ëŒ€ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 3000);
        });

        // ë°°ê´€ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function togglePipes() {
            const pipes = document.querySelectorAll('.gas-pipe, .info-label');
            pipesVisible = !pipesVisible;
            
            pipes.forEach(pipe => {
                pipe.setAttribute('visible', pipesVisible);
            });
        }

        // ëœë¤ ìœ„ì¹˜ì— ë°°ê´€ ì¶”ê°€
        function addRandomPipe() {
            const container = document.getElementById('pipe-container');
            const scene = document.querySelector('a-scene');
            
            // ëœë¤ ìœ„ì¹˜ ìƒì„±
            const x = (Math.random() - 0.5) * 6;
            const z = -2 - Math.random() * 4;
            const diameter = 0.05 + Math.random() * 0.1;
            const length = 1 + Math.random() * 2;
            
            // ìƒˆ ë°°ê´€ ìƒì„±
            const newPipe = document.createElement('a-cylinder');
            newPipe.setAttribute('position', `${x} -1 ${z}`);
            newPipe.setAttribute('rotation', '0 0 90');
            newPipe.setAttribute('radius', diameter.toString());
            newPipe.setAttribute('height', length.toString());
            newPipe.setAttribute('material', 'color: #35ff6b; metalness: 0.6; roughness: 0.3');
            newPipe.setAttribute('class', 'gas-pipe');
            
            // ì •ë³´ ë¼ë²¨ ì¶”ê°€
            const label = document.createElement('a-text');
            const pipeId = `GP-${String(pipeCount + 100).padStart(3, '0')}`;
            label.setAttribute('value', `${pipeId}\nì‹ ê·œ ë°°ê´€\nì§ê²½: ${Math.round(diameter * 400)}mm`);
            label.setAttribute('position', `${x} 1 ${z}`);
            label.setAttribute('align', 'center');
            label.setAttribute('color', 'white');
            label.setAttribute('background', 'color: rgba(0,100,0,0.7); opacity: 0.8');
            label.setAttribute('scale', '0.5 0.5 0.5');
            label.setAttribute('class', 'info-label');
            
            container.appendChild(newPipe);
            container.appendChild(label);
            
            pipeCount++;
            document.getElementById('pipeCount').textContent = pipeCount;
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            newPipe.setAttribute('animation', 'property: scale; from: 0 0 0; to: 1 1 1; dur: 1000');
        }

        // ëª¨ë“  ë°°ê´€ ì‚­ì œ
        function clearAllPipes() {
            const container = document.getElementById('pipe-container');
            container.innerHTML = '';
            pipeCount = 0;
            document.getElementById('pipeCount').textContent = pipeCount;
        }

        // ë°°ê´€ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
        document.addEventListener('click', function(event) {
            const target = event.target;
            if (target.classList.contains('gas-pipe')) {
                alert('ë°°ê´€ ìƒì„¸ ì •ë³´:\n- ì„¤ì¹˜ì¼: 2023-03-15\n- ìµœê·¼ ì ê²€: 2024-08-20\n- ìƒíƒœ: ì •ìƒ\n- ë‹´ë‹¹ì: ê¹€ê¸°ì‚¬');
            }
        });

        // í„°ì¹˜ ì œìŠ¤ì²˜ ì§€ì›
        AFRAME.registerComponent('gesture-detector', {
            schema: {
                element: {default: ''}
            },
            init: function () {
                this.targetElement = this.data.element && document.querySelector(this.data.element);
                this.internalState = {
                    previousState: null
                };
            },
            handlers: {
                touchstart: function (e) {
                    this.internalState.previousState = e;
                },
                touchend: function (e) {
                    const previousState = this.internalState.previousState;
                    if (previousState && previousState.touches && previousState.touches.length === 2 && e.changedTouches && e.changedTouches.length === 2) {
                        // ì¤Œ ì œìŠ¤ì²˜ ê°ì§€
                        const dx = e.changedTouches[0].clientX - e.changedTouches[1].clientX;
                        const dy = e.changedTouches[0].clientY - e.changedTouches[1].clientY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // ê°„ë‹¨í•œ ì¤Œ íš¨ê³¼ êµ¬í˜„
                        const camera = document.querySelector('a-camera-static');
                        if (camera) {
                            const currentPos = camera.getAttribute('position');
                            const newZ = Math.max(-8, Math.min(-1, currentPos.z + (distance > 100 ? 0.5 : -0.5)));
                            camera.setAttribute('position', `${currentPos.x} ${currentPos.y} ${newZ}`);
                        }
                    }
                    this.internalState.previousState = null;
                }
            }
        });

        // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
        setInterval(() => {
            const scene = document.querySelector('a-scene');
            if (scene && scene.renderer) {
                console.log('FPS:', scene.renderer.info.render.frame);
            }
        }, 5000);
    </script>
</body>
</html>