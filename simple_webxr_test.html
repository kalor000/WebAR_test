<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }
        
        .container {
            max-width: 600px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            margin-bottom: 30px;
            color: #4ECDC4;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        button {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
            color: #4CAF50;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #F44336;
            color: #F44336;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.3);
            border: 2px solid #FFC107;
            color: #FFC107;
        }
        
        .info {
            background: rgba(33, 150, 243, 0.3);
            border: 2px solid #2196F3;
            color: #2196F3;
        }
        
        .feature-list {
            text-align: left;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .feature-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .feature-item:last-child {
            border-bottom: none;
        }
        
        .check {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .cross {
            color: #F44336;
            font-weight: bold;
        }
        
        code {
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ•¶ï¸ WebXR í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h3>ğŸ” ì‹œìŠ¤í…œ í™•ì¸</h3>
            <div class="feature-list" id="systemCheck">
                <div class="feature-item">
                    <span>HTTPS ì—°ê²°</span>
                    <span id="httpsCheck">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="feature-item">
                    <span>WebXR API</span>
                    <span id="webxrCheck">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="feature-item">
                    <span>AR ì„¸ì…˜ ì§€ì›</span>
                    <span id="arSessionCheck">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="feature-item">
                    <span>DOM Overlay</span>
                    <span id="domOverlayCheck">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="feature-item">
                    <span>Hit Test</span>
                    <span id="hitTestCheck">í™•ì¸ ì¤‘...</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“± ê¸°ê¸° ì •ë³´</h3>
            <div id="deviceInfo" class="status info">
                ê¸°ê¸° ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª WebXR í…ŒìŠ¤íŠ¸</h3>
            <button id="testBtn" onclick="testBasicWebXR()">ê¸°ë³¸ WebXR í…ŒìŠ¤íŠ¸</button>
            <button id="arTestBtn" onclick="testARSession()" disabled>AR ì„¸ì…˜ í…ŒìŠ¤íŠ¸</button>
            <div id="testResult" class="status" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ› ï¸ ê¶Œì¥ ì„¤ì •</h3>
            <div class="info status">
                <strong>Chrome Flags ì„¤ì •:</strong><br>
                1. <code>chrome://flags/#webxr-incubations</code> â†’ Enabled âœ…<br>
                2. <code>chrome://flags/#enable-webxr-ar-module</code> â†’ Enabled<br>
                3. <code>chrome://flags/#webxr-ar-dom-overlay</code> â†’ Enabled<br>
                4. Chrome ì¬ì‹œì‘ í•„ìš”
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ ëŒ€ì•ˆ ë°©ë²•</h3>
            <button onclick="goToARJS()" style="background: linear-gradient(45deg, #4ECDC4, #44A08D);">
                AR.js ë²„ì „ ì‚¬ìš©í•˜ê¸°
            </button>
            <button onclick="testWebRTC()" style="background: linear-gradient(45deg, #667eea, #764ba2);">
                ì¹´ë©”ë¼ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
            </button>
        </div>
    </div>

    <script>
        let systemCompatible = false;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ê²€ì‚¬
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemCompatibility();
            getDeviceInfo();
        });

        async function checkSystemCompatibility() {
            // HTTPS í™•ì¸
            const isHTTPS = location.protocol === 'https:' || location.hostname === 'localhost';
            document.getElementById('httpsCheck').innerHTML = isHTTPS ? 
                '<span class="check">âœ“</span>' : '<span class="cross">âœ—</span>';

            // WebXR API í™•ì¸
            const hasWebXR = 'xr' in navigator;
            document.getElementById('webxrCheck').innerHTML = hasWebXR ? 
                '<span class="check">âœ“</span>' : '<span class="cross">âœ—</span>';

            if (!hasWebXR) {
                document.getElementById('arSessionCheck').innerHTML = '<span class="cross">âœ—</span>';
                document.getElementById('domOverlayCheck').innerHTML = '<span class="cross">âœ—</span>';
                document.getElementById('hitTestCheck').innerHTML = '<span class="cross">âœ—</span>';
                return;
            }

            try {
                // AR ì„¸ì…˜ ì§€ì› í™•ì¸
                const arSupported = await navigator.xr.isSessionSupported('immersive-ar');
                document.getElementById('arSessionCheck').innerHTML = arSupported ? 
                    '<span class="check">âœ“</span>' : '<span class="cross">âœ—</span>';
                
                if (arSupported) {
                    document.getElementById('arTestBtn').disabled = false;
                    systemCompatible = true;
                }

                // DOM Overlay ì§€ì› í™•ì¸ (ì‹¤í—˜ì )
                try {
                    await navigator.xr.requestSession('immersive-ar', {
                        requiredFeatures: [],
                        optionalFeatures: ['dom-overlay']
                    });
                    document.getElementById('domOverlayCheck').innerHTML = '<span class="check">âœ“</span>';
                } catch (e) {
                    // ì„¸ì…˜ ìš”ì²­ì´ ì‹¤íŒ¨í•´ë„ ê¸°ëŠ¥ ìì²´ëŠ” ì§€ì›í•  ìˆ˜ ìˆìŒ
                    document.getElementById('domOverlayCheck').innerHTML = '<span class="warning">?</span>';
                }

                // Hit Test ì§€ì› í™•ì¸
                try {
                    await navigator.xr.requestSession('immersive-ar', {
                        requiredFeatures: ['hit-test'],
                        optionalFeatures: []
                    });
                    document.getElementById('hitTestCheck').innerHTML = '<span class="check">âœ“</span>';
                } catch (e) {
                    document.getElementById('hitTestCheck').innerHTML = '<span class="cross">âœ—</span>';
                }

            } catch (error) {
                console.error('WebXR í˜¸í™˜ì„± í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                document.getElementById('arSessionCheck').innerHTML = '<span class="cross">âœ—</span>';
                document.getElementById('domOverlayCheck').innerHTML = '<span class="cross">âœ—</span>';
                document.getElementById('hitTestCheck').innerHTML = '<span class="cross">âœ—</span>';
            }
        }

        function getDeviceInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                screenWidth: screen.width,
                screenHeight: screen.height,
                colorDepth: screen.colorDepth
            };

            const deviceDiv = document.getElementById('deviceInfo');
            deviceDiv.innerHTML = `
                <strong>ë¸Œë¼ìš°ì €:</strong> ${getBrowserName()}<br>
                <strong>í”Œë«í¼:</strong> ${info.platform}<br>
                <strong>í™”ë©´:</strong> ${info.screenWidth}x${info.screenHeight}<br>
                <strong>ìƒ‰ìƒ ì‹¬ë„:</strong> ${info.colorDepth}bit<br>
                <strong>ì˜¨ë¼ì¸:</strong> ${info.onLine ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}
            `;
        }

        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'Unknown';
        }

        async function testBasicWebXR() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'status info';
            resultDiv.textContent = 'ê¸°ë³¸ WebXR í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...';

            try {
                if (!navigator.xr) {
                    throw new Error('WebXR APIê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                }

                const supported = await navigator.xr.isSessionSupported('immersive-ar');
                
                if (supported) {
                    resultDiv.className = 'status success';
                    resultDiv.textContent = 'âœ… WebXR AR ì„¸ì…˜ì´ ì§€ì›ë©ë‹ˆë‹¤! AR í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                    document.getElementById('arTestBtn').disabled = false;
                } else {
                    resultDiv.className = 'status warning';
                    resultDiv.textContent = 'âš ï¸ WebXRëŠ” ì§€ì›ë˜ì§€ë§Œ AR ì„¸ì…˜ì€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                }

            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.textContent = `âŒ WebXR í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`;
                console.error('WebXR í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        async function testARSession() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'status info';
            resultDiv.textContent = 'AR ì„¸ì…˜ ìƒì„± í…ŒìŠ¤íŠ¸ ì¤‘... ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';

            try {
                // ìµœì†Œí•œì˜ ì„¤ì •ìœ¼ë¡œ AR ì„¸ì…˜ ìš”ì²­
                const session = await navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: [],
                    optionalFeatures: ['local', 'local-floor', 'bounded-floor']
                });

                resultDiv.className = 'status success';
                resultDiv.textContent = 'ğŸ‰ AR ì„¸ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! WebXRì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.';
                
                // ì„¸ì…˜ ì¢…ë£Œ
                setTimeout(() => {
                    session.end();
                    resultDiv.textContent += '\n\nâœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ. ì´ì œ ì‹¤ì œ ê°€ìŠ¤ê´€ AR ì•±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                }, 3000);

            } catch (error) {
                resultDiv.className = 'status error';
                let errorMessage = `âŒ AR ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: ${error.message}`;
                
                // êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
                if (error.message.includes('not supported')) {
                    errorMessage += '\n\nğŸ’¡ í•´ê²°ë°©ë²•:\n1. Chrome Flags ì„¤ì • í™•ì¸\n2. HTTPS í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸\n3. ARCore ì§€ì› ê¸°ê¸° ì‚¬ìš©';
                } else if (error.message.includes('permission')) {
                    errorMessage += '\n\nğŸ’¡ ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”';
                }
                
                resultDiv.textContent = errorMessage;
                console.error('AR ì„¸ì…˜ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        async function testWebRTC() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'status info';
            resultDiv.textContent = 'ì¹´ë©”ë¼ ì ‘ê·¼ í…ŒìŠ¤íŠ¸ ì¤‘...';

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                resultDiv.className = 'status success';
                resultDiv.textContent = 'âœ… ì¹´ë©”ë¼ ì ‘ê·¼ ì„±ê³µ! ê¸°ë³¸ì ì¸ ê¶Œí•œì€ ì •ìƒì…ë‹ˆë‹¤.';
                
                // ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                resultDiv.className = 'status error';
                resultDiv.textContent = `âŒ ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨: ${error.message}`;
            }
        }

        function goToARJS() {
            const confirmation = confirm('AR.js ë²„ì „ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë” ë„“ì€ ê¸°ê¸° í˜¸í™˜ì„±)');
            if (confirmation) {
                // AR.js ë²„ì „ ì‚¬ìš© (ì´ì „ì— ë§Œë“  ë²„ì „)
                alert('AR.js ë²„ì „ì„ ì‚¬ìš©í•˜ì„¸ìš”. WebXR ë¬¸ì œë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ (Chrome Flags ë³€ê²½ í›„)
        if (location.search.includes('refresh')) {
            setTimeout(() => {
                location.href = location.href.replace('?refresh=1', '');
            }, 2000);
        }
    </script>
</body>
</html>